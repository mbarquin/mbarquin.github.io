<!DOCTYPE html><html lang="es-ES"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Publicación de desarrollos, análisis y tests sobre las nuevas librerías y herramientas para la programación PHP"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@mercenariophp"><meta name="twitter:title" content="PHP Dotenv, configuración en variables de entorno"><meta name="twitter:description" content="Actualmente se considera que mantener los parámetros sensibles de configuración, como los datos de conexión a base de datos, la key de una API, etc.. en un fichero de configuración que va a ser leído por la aplicación, como algo inseguro. El camino más fiable para poder disponer de esta información será través de las variables de entorno. El propio autor menciona la sección relativa a la configuración de [The Twelve Factor App](https://www.12factor.net/config), una metodología ampliamente aceptada para el desarrollo de aplicaciones. El fichero finalmente se puede filtrar de alguna manera, mientras que las variables de entorno al estar solo presentes en la sesión de la ejecución, no. El servidor se puede parametrizar para que estas no sean propagadas arbitrariamente entre los subprocesos que se deriven del principal."><meta property="og:title" content="PHP Dotenv, configuración en variables de entorno"><meta property="og:description" content="Actualmente se considera que mantener los parámetros sensibles de configuración, como los datos de conexión a base de datos, la key de una API, etc.. en un fichero de configuración que va a ser leído por la aplicación, como algo inseguro."><meta property="og:image" content="https://www.mercenariophp.com/images/mp/mpLogo.png"><meta property="og:url" content="https://www.mercenariophp.com/php-dotenv-variables-entorno/"><title>PHP Dotenv, configuración en variables de entorno | mercenariophp</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">PHP Dotenv, configuración en variables de entorno</h1><a id="logo" href="/.">mercenariophp</a><p class="description">Experimentos y anotaciones de un dev</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> Inicio</i></a><a href="/archives/"><i class="icon-archive"> Archivo</i></a><a href="/repos/"><i class="icon-github"> Repos</i></a><a href="/mbarquin/"><i class="icon-about"> mbarquin</i></a><a href="/atom.xml"><i class="icon-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">PHP Dotenv, configuración en variables de entorno</h1><div class="post-meta">06 / 11 / 2017<span class="categories"> | Guardado en<a href="/categories/Desarrollo/"> Desarrollo</a></span></div><span data-disqus-identifier="php-dotenv-variables-entorno/" class="disqus-comment-count"></span><div class="post-content"><p>Actualmente se considera que mantener los parámetros sensibles de configuración, como los datos de conexión a base de datos, la key de una API, etc.. en un fichero de configuración que va a ser leído por la aplicación, como algo inseguro. El camino más fiable para poder disponer de esta información será través de las variables de entorno. El propio autor menciona la sección relativa a la configuración de <a href="https://www.12factor.net/config" target="_blank" rel="noopener">The Twelve Factor App</a>, una metodología ampliamente aceptada para el desarrollo de aplicaciones. El fichero finalmente se puede filtrar de alguna manera, mientras que las variables de entorno al estar solo presentes en la sesión de la ejecución, no. El servidor se puede parametrizar para que estas no sean propagadas arbitrariamente entre los subprocesos que se deriven del principal.</p>
<p>Para no tener que preocuparnos de esta configuración <strong>en los entornos de desarrollo</strong>, la librería <a href="https://github.com/vlucas/phpdotenv" target="_blank" rel="noopener">PHP dotenv</a> se encargará de leer un fichero donde recogerá los valores de estas variables y las inyectará en los arrays $_ENV y $_SERVER también las hará accesibles a través de la function getenv(). De esa manera podremos acceder a estos valores como en producción.</p>
<a id="more"></a>
<h3 id="Uso"><a href="#Uso" class="headerlink" title="Uso"></a>Uso</h3><p>La librería <a href="https://github.com/vlucas/phpdotenv" target="_blank" rel="noopener">PHP dotenv</a> es de las más utilizadas, se puede incluir en cualquier proyecto mediante <a href="/tutorial-php-composer/">Composer</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php composer.phar require vlucas/phpdotenv</span><br></pre></td></tr></table></figure>

<p>Tras su instalación necesitaremos crear un archivo .env donde almacenaremos los valores que vamos a consultar a través de las variables de entorno. El autor recomienda incluir el archivo .env en .gitignore, ignorarlo en el control de versiones que estemos utilizando. Para almacenar se puede generar un archivo modelo, lo más habitual es añadirle la extensión .dist, el autor recomienda .example, pero es más común el uso de .dist . Así que generaremos un archivo .env.dist con las variables necesarias, pero, con valores falsos, de manera que, un desarrollador las pueda copiar a un fichero .env y configurar ahí los valores reales correspondientes a su entorno.</p>
<p>La sintaxis es sencilla, VARIABLE_STRING=”string”, VARIABLE_INT=99 o VARIABLE_INT=”99”. Admite comentarios precedidos por #.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env.dist</span></span><br><span class="line">DB_USER=<span class="string">"falseUsername"</span></span><br><span class="line">DB_PASSWD=<span class="string">"falsepass"</span></span><br><span class="line">DB_NAME=<span class="string">"dbname"</span></span><br><span class="line">DB_HOST=<span class="string">"localhost"</span></span><br><span class="line">DB_PORT=3306</span><br></pre></td></tr></table></figure>

<p>Una vez copiado el fichero a .env y cambiado los datos a los reales, cargamos los valores haciendo una instancia del objeto Dotenv, usando como parámetro el directorio del fichero .env. Posteriormente llamamos a la función load(), para que incluya las variables en memoria.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'../vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line">$dotenv = <span class="keyword">new</span> Dotenv\Dotenv(<span class="keyword">__DIR__</span>);</span><br><span class="line">$dotenv-&gt;load();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> getenv(<span class="string">'DB_USER'</span>) . PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> $_ENV[<span class="string">'DB_USER'</span>] . PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> $_SERVER[<span class="string">'DB_USER'</span>] . PHP_EOL;</span><br></pre></td></tr></table></figure>

<p>Mediante cualquiera de los tres métodos arriba descritos, tras el load(), podremos obtener su valor. la función getenv() o las globales $_ENV y $_SERVER.</p>
<h3 id="Variables-anidadas"><a href="#Variables-anidadas" class="headerlink" title="Variables anidadas."></a>Variables anidadas.</h3><p>Podemos hacer declaraciones de variables que usan variables anteriormente definidas. Se referencian con ${…}</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BASE_DIR=<span class="string">"/var/www/project"</span></span><br><span class="line">CACHE_DIR=<span class="string">"<span class="variable">$&#123;BASE_DIR&#125;</span>/cache"</span></span><br><span class="line">TMP_DIR=<span class="string">"<span class="variable">$&#123;BASE_DIR&#125;</span>/tmp"</span></span><br></pre></td></tr></table></figure>

<h3 id="Requiriendo-variables"><a href="#Requiriendo-variables" class="headerlink" title="Requiriendo variables."></a>Requiriendo variables.</h3><p>Se puede requerir que exista una o varias variables de entorno para la ejecución del programa, se invoca la función required() usando como parámetro un string con el nombre de la variable requerida o un array de strings con multiples variables. En caso de no estar definidas el sistema devolverá una Runtime Exception.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'../vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line">$dotenv = <span class="keyword">new</span> Dotenv\Dotenv(<span class="keyword">__DIR__</span>);</span><br><span class="line">$dotenv-&gt;load();</span><br><span class="line"></span><br><span class="line">$dotenv-&gt;required(<span class="string">'DATABASE_DSN'</span>)-&gt;notEmpty();</span><br><span class="line">$dotenv-&gt;required([<span class="string">'DB_HOST'</span>, <span class="string">'DB_NAME'</span>, <span class="string">'DB_USER'</span>, <span class="string">'DB_PASSWD'</span>]);</span><br></pre></td></tr></table></figure>

<p>En el primer ejemplo, tras el require se puede ver la llamada a la función notEmpty(), que asegurará que la variable además contenga valor. Tendremos que añadir la variable al archivo .env y darle un valor para evitar la Exception.</p>
<p>También se puede comprobar que la variable sea integer required(‘DB_PORT’)-&gt;isInteger() o que contenga alguno de multiples valores definidos required(‘DB_HOST’)-&gt;allowedValues([“val1”, “val2”]).</p>
<h3 id="…"><a href="#…" class="headerlink" title="…"></a>…</h3><p>Una herramienta muy versátil que hará más portable el proyecto al poder ser inicializado rápidamente por cualquier desarrollador de una manera standard… Últimamente estoy más escaso de tiempo que nunca, pero aprendiendo un montón de cosas nuevas, espero poder transmitir algunas de ellas por aquí, herramientas, webs, standares… Camino a la APIficación ;) ..</p>
</div><div class="tags"><a href="/tags/PHP/">PHP</a><a href="/tags/Herramientas/">Herramientas</a></div><div class="post-nav"><a href="/vacaciones/" class="next">Vacaciones<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'mercenariophp';
var disqus_identifier = 'php-dotenv-variables-entorno/';
var disqus_title = 'PHP Dotenv, configuración en variables de entorno';
var disqus_url = 'https://www.mercenariophp.com/php-dotenv-variables-entorno/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//mercenariophp.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"><input type="hidden" name="sitesearch" value="https://www.mercenariophp.com"></form></div><div class="widget lessMargin"><div style="text-align: left;"><div style="width: 84px; height: 40px;"><a href="https://twitter.com/mercenariophp" rel="nofollow" target="_blank" class="twitter_big"></a><a href="https://es.linkedin.com/in/moisés-barquín-salgado-b6148296" rel="nofollow" target="_blank" class="linkedin_big"></a></div></div></div><div class="widget"><div class="widget-title">Categorías</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Desarrollo/">Desarrollo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutoriales-Symfony/">Tutoriales Symfony</a></li></ul></div><div class="widget"><div class="widget-title">Etiquetas</div><div class="tagcloud"><a href="/tags/tests/" style="font-size: 15px;">tests</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/PagesGenerator/" style="font-size: 15px;">PagesGenerator</a> <a href="/tags/Herramientas/" style="font-size: 15px;">Herramientas</a> <a href="/tags/Tutorial/" style="font-size: 15px;">Tutorial</a> <a href="/tags/PHPUnit/" style="font-size: 15px;">PHPUnit</a> <a href="/tags/Composer/" style="font-size: 15px;">Composer</a> <a href="/tags/NetBeans/" style="font-size: 15px;">NetBeans</a> <a href="/tags/IDE/" style="font-size: 15px;">IDE</a> <a href="/tags/ReactPHP/" style="font-size: 15px;">ReactPHP</a> <a href="/tags/Slim/" style="font-size: 15px;">Slim</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/Pattern/" style="font-size: 15px;">Pattern</a> <a href="/tags/Repositorio/" style="font-size: 15px;">Repositorio</a> <a href="/tags/Frameworks/" style="font-size: 15px;">Frameworks</a></div></div><div class="widget"><div class="widget-title">Recientes</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/php-dotenv-variables-entorno/">PHP Dotenv, configuración en variables de entorno</a></li><li class="post-list-item"><a class="post-list-link" href="/vacaciones/">Vacaciones</a></li><li class="post-list-item"><a class="post-list-link" href="/retornando-objetos-valor/">Retornando objetos de valor en lugar de arrays</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-bundles-knpmenubundle/">Tutorial de Symfony 3: Bundles y KnpMenuBundle</a></li><li class="post-list-item"><a class="post-list-link" href="/descarga-ficheros-comprimidos-Archivestream-php/">Descarga de ficheros comprimidos con ArchiveStream-php</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-doctrine-orm/">Tutorial de Symfony 3: Doctrine ORM y Base de Datos</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-twig/">Tutorial de Symfony 3: Twig, base layout con Bootstrap</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony/">Tutorial de Symfony 3: Instalación, routing y controllers</a></li><li class="post-list-item"><a class="post-list-link" href="/refactorizando-reactphp-slim/">Refactorizando reactphp-slim</a></li><li class="post-list-item"><a class="post-list-link" href="/editor-hackeable-atom/">Editor hackeable Atom, el editor para el siglo 21</a></li></ul></div><div class="widget"><div class="widget-title">Comentarios recientes</div><script type="text/javascript" src="//mercenariophp.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">Blogroll</div><ul></ul><a href="http://www.phptherightway.com/" title="PHP The Right Way" target="_blank">PHP The Right Way</a></div></div></div></div><div id="footer"><a href="https://twitter.com/mercenariophp" rel="nofollow" class="twitter"></a> <a href="https://es.linkedin.com/in/moisés-barquín-salgado-b6148296" rel="nofollow" class="linkedin"></a> © <a href="/." rel="nofollow">mercenariophp.</a> With<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-78289384-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>