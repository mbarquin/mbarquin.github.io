<!DOCTYPE html><html lang="es-ES"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Publicación de desarrollos, análisis y tests sobre las nuevas librerías y herramientas para la programación PHP"><title>Slim3 controllers usando DI con el patrón Factory | mercenariophp</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Slim3 controllers usando DI con el patrón Factory</h1><a id="logo" href="/.">mercenariophp</a><p class="description">Experimentos y anotaciones de un dev</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> Inicio</i></a><a href="/archives/"><i class="icon-archive"> Archivo</i></a><a href="/repos/"><i class="icon-github"> Repos</i></a><a href="/mbarquin/"><i class="icon-about"> mbarquin</i></a><a href="/atom.xml"><i class="icon-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Slim3 controllers usando DI con el patrón Factory</h1><div class="post-meta">27 / 04 / 2016<span class="categories"> | Guardado en<a href="/categories/Desarrollo/"> Desarrollo</a></span></div><span data-disqus-identifier="slim-controller-usando-di-patron-factory/" class="disqus-comment-count"></span><div class="post-content"><p>Rob Allen <a href="https://akrabat.com/di-factories-for-slim-controllers/" target="_blank" rel="noopener">describe en su blog</a> la forma en que él genera los controladores en <a href="http://www.slimframework.com/" target="_blank" rel="noopener">Slim3</a>, este framework asocia las rutas con un método, clase callable, o closure para resolver la llamada. En este ejemplo inyecta una closure al contenedor, esta funciona <a href="https://es.wikipedia.org/wiki/Factory_Method_%28patr%C3%B3n_de_dise%C3%B1o%29" target="_blank" rel="noopener">según el patrón Factory</a>, se encarga de resolver las dependencias y devuelve una <strong>nueva</strong> clase “Controller” a cada llamada.</p>
<a id="more"></a>

<p>Por defecto configura el router utilizando un string, donde indica la clase y método a llamar. Con esta definición el framework intentará obtener una instancia de la clase usando el contenedor de dependencias. De manera que al llamar a la url <a href="http://www.midominion.com/list" target="_blank" rel="noopener">www.midominion.com/list</a> mediante GET, se instanciara la clase MyController para llamar al método listAction. En la documentación es más común el ejemplo en que definen directamente una closure para atender la llamada.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$app-&gt;get(<span class="string">'/list'</span>, <span class="string">'MyController:listAction'</span>);</span><br></pre></td></tr></table></figure>

<p>Para que la ruta se resuelva correctamente, previamente debemos haber inyectado al contenedor las dependencias necesarias. En este caso genera primero una closure para obtener un objeto de conexión a base de datos, no entiendo bien porqué hacerlo Factory, quizás el código sea algo más sencillo y para este ejemplo suficiente.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Retrieve container instance</span></span><br><span class="line">$container = $app-&gt;getContainer();</span><br><span class="line"></span><br><span class="line">$container[<span class="string">'DatabaseService'</span>] = <span class="function"><span class="keyword">function</span> <span class="params">($c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DatabaseService();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$container[<span class="string">'MyController'</span>] = <span class="function"><span class="keyword">function</span> <span class="params">($c)</span> </span>&#123;</span><br><span class="line">    $dbService = $c-&gt;get(<span class="string">'DatabaseService'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyController($dbService);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Posteriormente ya vemos como asocia al container DI la closure que devuelve el controlador con la base de datos ya inyectada. Una vez invocada la ruta adecuada el sistema instanciará la clase y llamará al método según el estándar de Slim, con los parámetros $request, $response y $args.</p>
<p>Así quedaría la clase del “Controller”.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $dbService;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($dbService)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;dbService = $dbService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">listAction</span><span class="params">($request, $response, $args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $dataArray = <span class="keyword">$this</span>-&gt;dbService-&gt;fetchData();</span><br><span class="line">        <span class="keyword">return</span> $response-&gt;withJson($dataArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>La idea me parece extrapolable a otros muchos contextos, además ahora casi todos los frameworks incluyen alguna suerte de contenedor DI. Aunque el recomienda especificar un controller para una sola acción. Creo que para determinados desarrollos en que no haga falta tanta optimización, se puede generar un router dinámico, en breve colgaré un pequeño desarrollo de esto que tengo en Slim 2, a ver que sale mezclándolo con esta idea…</p>
</div><div class="tags"><a href="/tags/PHP/">PHP</a><a href="/tags/Slim/">Slim</a><a href="/tags/Pattern/">Pattern</a></div><div class="post-nav"><a href="/estructura-directorios-proyecto-php/" class="pre"><i class="icon-previous">Estructura de un proyecto PHP</i></a><a href="/Jigsaw-generador-php-paginas-estaticas/" class="next">Jigsaw, generador PHP de páginas estáticas<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'mercenariophp';
var disqus_identifier = 'slim-controller-usando-di-patron-factory/';
var disqus_title = 'Slim3 controllers usando DI con el patrón Factory';
var disqus_url = 'https://www.mercenariophp.com/slim-controller-usando-di-patron-factory/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//mercenariophp.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"><input type="hidden" name="sitesearch" value="https://www.mercenariophp.com"></form></div><div class="widget lessMargin"><div style="text-align: left;"><div style="width: 84px; height: 40px;"><a href="https://twitter.com/mercenariophp" rel="nofollow" target="_blank" class="twitter_big"></a><a href="https://es.linkedin.com/in/moisés-barquín-salgado-b6148296" rel="nofollow" target="_blank" class="linkedin_big"></a></div></div></div><div class="widget"><div class="widget-title">Categorías</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Desarrollo/">Desarrollo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutoriales-Symfony/">Tutoriales Symfony</a></li></ul></div><div class="widget"><div class="widget-title">Etiquetas</div><div class="tagcloud"><a href="/tags/tests/" style="font-size: 15px;">tests</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/PagesGenerator/" style="font-size: 15px;">PagesGenerator</a> <a href="/tags/Herramientas/" style="font-size: 15px;">Herramientas</a> <a href="/tags/Tutorial/" style="font-size: 15px;">Tutorial</a> <a href="/tags/PHPUnit/" style="font-size: 15px;">PHPUnit</a> <a href="/tags/Composer/" style="font-size: 15px;">Composer</a> <a href="/tags/NetBeans/" style="font-size: 15px;">NetBeans</a> <a href="/tags/IDE/" style="font-size: 15px;">IDE</a> <a href="/tags/ReactPHP/" style="font-size: 15px;">ReactPHP</a> <a href="/tags/Slim/" style="font-size: 15px;">Slim</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/Pattern/" style="font-size: 15px;">Pattern</a> <a href="/tags/Repositorio/" style="font-size: 15px;">Repositorio</a> <a href="/tags/Frameworks/" style="font-size: 15px;">Frameworks</a></div></div><div class="widget"><div class="widget-title">Recientes</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/php-dotenv-variables-entorno/">PHP Dotenv, configuración en variables de entorno</a></li><li class="post-list-item"><a class="post-list-link" href="/vacaciones/">Vacaciones</a></li><li class="post-list-item"><a class="post-list-link" href="/retornando-objetos-valor/">Retornando objetos de valor en lugar de arrays</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-bundles-knpmenubundle/">Tutorial de Symfony 3: Bundles y KnpMenuBundle</a></li><li class="post-list-item"><a class="post-list-link" href="/descarga-ficheros-comprimidos-Archivestream-php/">Descarga de ficheros comprimidos con ArchiveStream-php</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-doctrine-orm/">Tutorial de Symfony 3: Doctrine ORM y Base de Datos</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-twig/">Tutorial de Symfony 3: Twig, base layout con Bootstrap</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony/">Tutorial de Symfony 3: Instalación, routing y controllers</a></li><li class="post-list-item"><a class="post-list-link" href="/refactorizando-reactphp-slim/">Refactorizando reactphp-slim</a></li><li class="post-list-item"><a class="post-list-link" href="/editor-hackeable-atom/">Editor hackeable Atom, el editor para el siglo 21</a></li></ul></div><div class="widget"><div class="widget-title">Comentarios recientes</div><script type="text/javascript" src="//mercenariophp.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">Blogroll</div><ul></ul><a href="http://www.phptherightway.com/" title="PHP The Right Way" target="_blank">PHP The Right Way</a></div></div></div></div><div id="footer"><a href="https://twitter.com/mercenariophp" rel="nofollow" class="twitter"></a> <a href="https://es.linkedin.com/in/moisés-barquín-salgado-b6148296" rel="nofollow" class="linkedin"></a> © <a href="/." rel="nofollow">mercenariophp.</a> With<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-78289384-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>