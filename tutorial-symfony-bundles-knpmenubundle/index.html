<!DOCTYPE html><html lang="es-ES"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Publicación de desarrollos, análisis y tests sobre las nuevas librerías y herramientas para la programación PHP"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@mercenariophp"><meta name="twitter:title" content="Tutorial de Symfony 3: Bundles y KnpMenuBundle"><meta name="twitter:description" content="Los bundles representan la modularidad de Symfony, en otros sistemas se denominaría plugin, es parecido, incluso mejor. En symfony todo es un bundle, desde las funcionalidades del propio core hasta el código de nuestras aplicaciones. Es fácil implementar nuevas features empaquetadas en bundles third-party o incluso redistribuir nuestro propio código, simplifican enormemente la tarea de escoger y mantener las funcionalidades que queremos implementar en nuestras aplicaciones."><meta name="twitter:image" content="https://www.mercenariophp.com/images/tutorialSymfony/symfony_bundles_lit.png"><meta property="og:title" content="Tutorial de Symfony 3: Bundles y KnpMenuBundle"><meta property="og:description" content="Los bundles representan la modularidad de Symfony, en otros sistemas se denominaría plugin, es parecido, incluso mejor. En symfony todo es un bundle, desde las funcionalidades del propio core hasta el código de nuestras aplicaciones. Es fácil implementar nuevas features empaquetadas en bundles third-party o incluso redistribuir nuestro propio código, simplifican enormemente la tarea de escoger y mantener las funcionalidades que queremos implementar en nuestras aplicaciones."><meta property="og:image" content="/images/tutorialSymfony/symfony_bundles.png"><meta property="og:url" content="https://www.mercenariophp.com/tutorial-symfony-bundles-knpmenubundle/"><title>Tutorial de Symfony 3: Bundles y KnpMenuBundle | mercenariophp</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Tutorial de Symfony 3: Bundles y KnpMenuBundle</h1><a id="logo" href="/.">mercenariophp</a><p class="description">Experimentos y anotaciones de un dev</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> Inicio</i></a><a href="/archives/"><i class="icon-archive"> Archivo</i></a><a href="/repos/"><i class="icon-github"> Repos</i></a><a href="/mbarquin/"><i class="icon-about"> mbarquin</i></a><a href="/atom.xml"><i class="icon-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Tutorial de Symfony 3: Bundles y KnpMenuBundle</h1><div class="post-meta">27 / 02 / 2017<span class="categories"> | Guardado en<a href="/categories/Tutoriales-Symfony/"> Tutoriales Symfony</a></span></div><span data-disqus-identifier="tutorial-symfony-bundles-knpmenubundle/" class="disqus-comment-count"></span><div class="post-content"><p><img src="/images/tutorialSymfony/symfony_bundles_lit.png" alt><br>Los bundles representan la modularidad de <a href="http://symfony.com/" target="_blank" rel="noopener">Symfony</a>, en otros sistemas se denominaría plugin, es parecido, incluso mejor. En symfony todo es un bundle, desde las funcionalidades del propio core hasta el código de nuestras aplicaciones. Es fácil implementar nuevas features empaquetadas en bundles third-party o incluso redistribuir nuestro propio código, simplifican enormemente la tarea de escoger y mantener las funcionalidades que queremos implementar en nuestras aplicaciones.</p>
<a id="more"></a>

<p>Un bundle es un simple conjunto de ficheros y directorios que implementan una única feature. Se puede crear el BlogBundle, el BackendBundle… Cada uno en su propia estructura de directorios, donde se almacenarán todos los sources, templates y configuraciones relativas a nuestra utilidad.</p>
<p>Los bundles son declarados en el método registerBundles() de la clase AppKernel, <strong>/app/AppKernel.php</strong>, en este fichero se implementan todas las features en uso, incluyendo las del propio core de Symfony. Estos se pueden implementar siempre y cuando estén disponibles mediante autoloading, estén donde estén ubicados.</p>
<h3 id="Creando-nuestro-primer-bundle"><a href="#Creando-nuestro-primer-bundle" class="headerlink" title="Creando  nuestro primer bundle"></a>Creando  nuestro primer bundle</h3><p>El sistema dispone de una herramienta para generar automáticamente la estructura de un nuevo bundle e inyectar su configuración a la aplicación ya existente. Este paso es innecesario, solo lo expongo para entender como funciona el sistema de adición de bundles, será más cómodo dejar a Symfony que cree automáticamente el nuevo bundle. Para hacer un pequeño test, cread el bundle a mano, borradlo, y, posteriormente recreadlo mediante el comando de consola de Symfony. Lo primero será crear el directorio /src/BackendBundle y dentro el fichero BackendBundle.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src /BackendBundle/BackendBundle.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">BackendBundle</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpKernel</span>\<span class="title">Bundle</span>\<span class="title">Bundle</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BackendBundle</span> <span class="keyword">extends</span> <span class="title">Bundle</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Esta es la pieza de código que marcará la existencia de nuestro bundle. Sencillamente necesitamos añadirla dentro de la clase <strong>/app/AppKernel.php</strong>.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/AppKernel.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">registerBundles</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $bundles = <span class="keyword">array</span>(</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// register your bundle</span></span><br><span class="line">        <span class="keyword">new</span> BackendBundle\BackendBundle(),</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $bundles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Tras inyectar el bundle al Kernel necesitamos que el sistema resuelva las rutas que definamos en el nuevo apartado, de manera que editamos el <strong>/app/config/routing.yaml</strong> para añadir el apartado backend. Ya de paso le indicamos un prefijo para el bundle, una palabra que se antepondrá a todas las rutas de los controllers de este Bundle, de manera que si definimos @Route(“/test”, name=”test_list”) en la acción de un controller, tendremos que acceder con la url <a href="http://url/prefijo/test" target="_blank" rel="noopener">http://url/prefijo/test</a>.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app:</span></span><br><span class="line"><span class="attr">    resource:</span> <span class="string">"@AppBundle/Controller/"</span></span><br><span class="line"><span class="attr">    type:</span>     <span class="string">annotation</span></span><br><span class="line"><span class="attr">backend:</span></span><br><span class="line"><span class="attr">    resource:</span> <span class="string">"@BackendBundle/Controller/"</span></span><br><span class="line"><span class="attr">    type:</span>     <span class="string">annotation</span></span><br><span class="line"><span class="attr">    prefix:</span>   <span class="string">"/backend/"</span></span><br></pre></td></tr></table></figure>

<p>A partir de ahora, con crear las carpetas necesarias dentro del nuevo bundle, como Controller, Entity, etc… Y añadiendo al sistema las rutas al nuevo apartado podremos dividir nuestro código en las piezas necesarias para su reutilización. Podéis hacer un test creando un controller que en su acción devuelva una response con texto plano como en el ejemplo list del source BlogController.</p>
<p>Si has seguido el test creo que será mejor borrar la carpeta /src/BackendBundle, borrar la entrada de /app/AppKernel.php y dejar el fichero routing.yml con la última modificación, así nos ahorraremos un paso.</p>
<h3 id="Creacion-automatica-del-bundle"><a href="#Creacion-automatica-del-bundle" class="headerlink" title="Creación automática del bundle"></a>Creación automática del bundle</h3><p>Todos los pasos anteriores los podemos dejar en manos de Symfony. Invocamos el comando de consola generate:bundle, encargado de generarlo y activarlo en el fichero AppKernel.php, de la siguiente manera.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php bin/console generate:bundle --namespace=BackendBundle</span><br></pre></td></tr></table></figure>

<p>Tras ejecutar el comando, el sistema nos preguntará la información relevante para generar el set de directorios y configuraciones necesarias. Preguntas cómo si el bundle va a ser compartido entre múltiples aplicaciones, su carpeta raíz, sistema de configuración, etc.. dejaremos todo como indican los valores por defecto, propuestos entre corchetes, solo tendremos que pulsar enter para confirmar este valor. Al final nos mostrará un resumen de operaciones y nos dirá que el bundle se ha creado con éxito.</p>
<p>Al igual que en caso de crearlo manualmente, en el fichero <strong>/app/config/routing.yml</strong> podremos proponer un prefijo <strong>backend</strong> para las rutas a los contenidos de este apartado. Debemos revisar que esta configuración sea correcta o en caso contrario pegar la propuesta anterior. <strong>La configuración del archivo /app/config/routing.yml está unas lineas más arriba.</strong></p>
<p>En la carpeta /src/BackendBundle/Controller se ha generado automáticamente un DefaultController.php con el que podemos hacer nuestro primer test navegando a <a href="http://localhost:8000/backend/" target="_blank" rel="noopener">http://localhost:8000/backend/</a>, recordad levantar el servidor antes si es que no lo habíais hecho ya.</p>
<p>Como veis, un simple Hello World, vamos a aplicar la herencia de twig para dejar la primera página del backend dentro del layout que ya hemos creado. Lo primero será <strong>duplicar</strong> el archivo base /app/Resources/views/base.html.twig y llamarle /app/Resources/views/backend.html.twig. Ahora, en el fichero /src/BackendBundle/Resources/views/Default/index.html.twig extendemos el backend layout de la siguiente manera.</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">extends</span></span> 'backend.html.twig' %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">block</span></span> body %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    Hello World!</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">endblock</span></span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">block</span></span> stylesheets %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="keyword">endblock</span></span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>

<p>Si navegamos nuevamente a la url del backend el “Hello World” ya estará integrado en nuestro template base.</p>
<p>Si nos vamos con el explorador a la carpeta <em>/src</em> de nuestro proyecto, podremos ver la estructura que ha sido generada. La estructura básica de un Bundle sería la siguiente, aunque en nuestro caso la mayoría de las carpetas no han sido creadas.</p>
<ul>
<li><p><strong>Controller/</strong><br>Contiene todos los controllers del bundle.</p>
</li>
<li><p><strong>DependencyInjection/</strong><br>Guarda ciertas clases extendibles para la inyección de dependencias, que podrían importar configuraciones de servicios, registrar pasos de compilación y más cosas. Esta carpeta no es obligatoria.</p>
</li>
<li><p><strong>Resources/config/</strong><br>Almacena las configuraciones específicas al bundle, configuraciones de ruta, de servicios, etc… (p.e. routing.yml).</p>
</li>
<li><p><strong>Resources/views/</strong><br>Guarda los ficheros de template organizados en carpetas por controllers (p.e. blog/index.html.twig).</p>
</li>
<li><p><strong>Resources/public/</strong><br>Contiene los recursos públicos, assets (css, imágenes …), es copiada o enlazada simbólicamente en el directorio público web mediante el siguiente comando de consola</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php bin/console assets:install</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Tests/</strong><br>  Se meten aquí todos los sources de tests.</p>
</li>
</ul>
<p>Este nuevo bundle será el encargado de mantener toda la lógica que necesitamos para crear el apartado de administración, a partir de ahora casi todo lo que hagamos acabará alojado en esta carpeta.</p>
<h3 id="Bundles-3rd-Party"><a href="#Bundles-3rd-Party" class="headerlink" title="Bundles 3rd. Party"></a>Bundles 3rd. Party</h3><p>La modularidad de los bundles va más allá de poder dividir nuestro código e independizarlo para copiarlo en otros proyectos, nos da la posibilidad de crear bundles para ser publicados, de manera que otros usuarios los instalen y mantengan muy sencillamente en sus proyectos mediante <a href="https://getcomposer.org/" target="_blank" rel="noopener">Composer</a> u otras herramientas. Hay una web “no-oficial” que se encarga de publicar y recoger información de los bundles públicos creados para Symfony, <a href="http://knpbundles.com/" target="_blank" rel="noopener">KnpBundles.com</a>.</p>
<h3 id="Instalando-KnpMenuBundle"><a href="#Instalando-KnpMenuBundle" class="headerlink" title="Instalando KnpMenuBundle"></a>Instalando KnpMenuBundle</h3><p><img src="/images/tutorialSymfony/KnpMenuBundle.png" alt><br>Vamos a centrarnos un poco en la instalación de uno de estos bundles como ejemplo, <a href="http://symfony.com/doc/master/bundles/KnpMenuBundle/index.html" target="_blank" rel="noopener">KnpMenuBundle</a>, cuyo uso es preconizado en el propio manual de Symfony. Este paquete se encargará de las tareas de mantenimiento y gestión de menús de una web. Para obtener el paquete solo debemos indicar a <a href="https://getcomposer.org/" target="_blank" rel="noopener">Composer</a> la nueva dependencia del proyecto.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require knplabs/knp-menu-bundle</span><br></pre></td></tr></table></figure>

<p>Tras la instalación del paquete necesitaremos implementar su uso en nuestro proyecto, de manera que editamos el fichero app/AppKernel.php para incluir su carga al sistema.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/AppKernel.php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppKernel</span> <span class="keyword">extends</span> <span class="title">Kernel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">registerBundles</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $bundles = <span class="keyword">array</span>(</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">new</span> Knp\Bundle\MenuBundle\KnpMenuBundle(),</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>El bundle ya usa una configuración por defecto incluida en sus propios sources, si deseamos utilizar otra o modificar la actual, podemos hacerlo sobre nuestro propio fichero de configuración <strong>app/config/config.yml</strong> incluyendo y modificando lo siguiente.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app/config/config.yml</span></span><br><span class="line"><span class="attr">knp_menu:</span></span><br><span class="line">    <span class="comment"># use "twig: false" to disable the Twig extension and the TwigRenderer</span></span><br><span class="line"><span class="attr">    twig:</span></span><br><span class="line"><span class="attr">        template:</span> <span class="attr">KnpMenuBundle::menu.html.twig</span></span><br><span class="line">    <span class="comment">#  if true, enables the helper for PHP templates</span></span><br><span class="line"><span class="attr">    templating:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># the renderer to use, list is also available by default</span></span><br><span class="line"><span class="attr">    default_renderer:</span> <span class="string">twig</span></span><br></pre></td></tr></table></figure>

<h3 id="Prerrequisitos-Main-menu"><a href="#Prerrequisitos-Main-menu" class="headerlink" title="Prerrequisitos, Main menú"></a>Prerrequisitos, Main menú</h3><p>Antes de empezar a crear el main menu vamos a setear el nombre de la ruta por defecto del backend, en la clase /src/BackendBundle/Controller/DefaultController.php anotamos el nombre de la ruta.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Route</span>("/", name="backend_home")</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">indexAction</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;render(<span class="string">'BackendBundle:Default:index.html.twig'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ahora necesitamos preparar la plantilla del layout del backend para recibir el menú, hay que hacerlo con sumo cuidado ya que la estructura de menú de sb-admin2 es grande y compleja. Yo he adaptado un poco el HTML para respetar la caja de búsqueda y para que el menú se represente correctamente debajo.</p>
<p>Localizad las etiquetas con mucho cuidado en el /app/Resources/views/backend.html.twig antes de hacer el reemplazo, si no, fallará el javascript encargado de hacer las animaciones del menú. Os pongo justo el lugar donde yo reemplacé el código del template y un enlace <a href="https://github.com/mbarquin/symfony3-tutorial/blob/master/app/Resources/views/backend.html.twig#L263" target="_blank" rel="noopener">AQUI</a> al source ya modificado. Hay que centrarse en las etiquetas comentario navbar-top-links y navbar-static-side para utilizar de referencia.</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">    <span class="comment">&lt;!-- /.navbar-top-links --&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-default sidebar"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-nav navbar-collapse"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-search"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group custom-search-form"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Search..."</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">type</span>=<span class="string">"button"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-search"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            </span><span class="template-variable">&#123;&#123; knp_menu_render('BackendBundle:Builder:mainMenu', &#123;'allow_safe_labels': true&#125;) | raw &#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- /.sidebar-collapse --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- /.navbar-static-side --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Dentro de nuestro recién creado <strong>/src/BackendBundle</strong> vamos a crear una carpeta denominada <strong>Menu</strong>, dentro, crearemos la clase <strong>Builder</strong>, esta será la encargada de generar los menús que precisemos, cada menú será un método de la clase. Es decir, si nuestro Bundle va a disponer de un menú principal y un menú de categorías, necesitaríamos crear dos métodos dentro de la clase Builder, <strong>mainMenu</strong> y <strong>categoriesMenu</strong>. En nuestro caso generaremos la clase Builder con un único menú principal, mainMenu.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/BackendBundle/Menu/Builder.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">BackendBundle</span>\<span class="title">Menu</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Knp</span>\<span class="title">Menu</span>\<span class="title">FactoryInterface</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">DependencyInjection</span>\<span class="title">ContainerAwareInterface</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">DependencyInjection</span>\<span class="title">ContainerAwareTrait</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">implements</span> <span class="title">ContainerAwareInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">use</span> <span class="title">ContainerAwareTrait</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mainMenu</span><span class="params">(FactoryInterface $factory, array $options)</span> </span>&#123;</span><br><span class="line">        $menu = $factory-&gt;createItem(<span class="string">'root'</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'currentClass'</span> =&gt; <span class="string">'active'</span>,</span><br><span class="line">            <span class="string">'childrenAttributes'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'class'</span> =&gt; <span class="string">'nav'</span>,</span><br><span class="line">                <span class="string">'id'</span> =&gt; <span class="string">'side-menu'</span></span><br><span class="line">            ),</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hijo de primer nivel.</span></span><br><span class="line">        $menu-&gt;addChild(<span class="string">'Home'</span>, <span class="keyword">array</span>(<span class="string">'route'</span> =&gt; <span class="string">'backend_home'</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Configuración mediante métodos.</span></span><br><span class="line">        $menu[<span class="string">'Home'</span>]-&gt;setLabel(<span class="string">'&lt;i class="fa fa-dashboard fa-fw"&gt;&lt;/i&gt; Home'</span>);</span><br><span class="line">        $menu[<span class="string">'Home'</span>]-&gt;setExtra(<span class="string">'safe_label'</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hijo de primer nivel.</span></span><br><span class="line">        $menu-&gt;addChild(<span class="string">'First entry'</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'route'</span> =&gt; <span class="string">'blog_list'</span>,</span><br><span class="line">            <span class="string">'routeParameters'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'id'</span> =&gt; <span class="number">1</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="string">'label'</span> =&gt; <span class="string">'&lt;i class="fa fa-table fa-fw"&gt;&lt;/i&gt; First entry'</span>,</span><br><span class="line">            <span class="string">'extras'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'safe_label'</span> =&gt; <span class="keyword">true</span></span><br><span class="line">            )</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hijo de primer nivel, submenu desplegable.</span></span><br><span class="line">        $menu-&gt;addChild(<span class="string">'Second entry'</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'uri'</span> =&gt; <span class="string">'#'</span>,</span><br><span class="line">            <span class="string">'attributes'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'aria-expanded'</span> =&gt; <span class="string">'true'</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="string">'label'</span> =&gt; <span class="string">'&lt;i class="fa fa-user fa-fw"&gt;&lt;/i&gt; Second entry&lt;span class="fa arrow"&gt;'</span>,</span><br><span class="line">            <span class="string">'extras'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'safe_label'</span> =&gt; <span class="keyword">true</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="string">'childrenAttributes'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'class'</span> =&gt; <span class="string">'nav nav-second-level'</span>,</span><br><span class="line">                <span class="string">'aria-expanded'</span> =&gt; <span class="string">'true'</span></span><br><span class="line">            )</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Añadir hijos a este submenu</span></span><br><span class="line">        $menu[<span class="string">'Second entry'</span>]-&gt;addChild(<span class="string">'Submenu entry'</span>, <span class="keyword">array</span>(<span class="string">'uri'</span> =&gt; <span class="string">'#test'</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ... Añadir más hijos</span></span><br><span class="line">        <span class="keyword">return</span> $menu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Utilizando la plantilla por defecto, <strong>knp_menu.html.twig</strong>, KnpMenuBundle generará anidamientos de tags “ul”, “li” y “a” para “escribir” el HTML del menú. Estos elementos se pueden formatear de múltiples formas, yo he elegido utilizar un setup en formato array desde el addChild() y he incluido un pequeño ejemplo de la otra manera en el caso Home. El otro método es muy similar, una vez añadamos un elemento al menu, este será accesible como el índice de un array en el mismo objeto, y, nos dará acceso a los métodos y propiedades de este elemento de menú a fin de poder setearlo o modificarlo. En este caso los métodos son setters y getters sobre los índices de los arrays de config utilizados, la propiedad attributes sera accesible mediante la función setAttributes, label será con setLabel(), etc…</p>
<ul>
<li><p><strong>route</strong><br>Se puede indicar como destino del enlace el nombre de una ruta definida en el sistema con el componente de route, como las definidas como anotación en las acciones de un Controller.</p>
</li>
<li><p><strong>routeParameters</strong><br>Añade el parámetro a la petición formada.</p>
</li>
<li><p><strong>uri</strong><br>Se utiliza para configurar como destino del menú un enlace HTML normal.</p>
</li>
<li><p><strong>label</strong><br>Define el texto del menú generalmente contenido en el enlace a. En este caso le pasamos también el código del elemento que dibuja el icono del menú, por lo que además hará falta definir el atributo “extras safe_label” para evitar que se parsee el HTML y cambie por HTMLEntities.</p>
</li>
<li><p><strong>childrenAttributes</strong><br>Da acceso a los atributos HTML del nodo contenedor de los hijos (ul), si creamos un elemento li con hijos, estos serán contenidos en un ul. En el caso del nodo root es lo mismo, nos da acceso a los atributos del ul dentro del que se engloba el menú.</p>
</li>
<li><p><strong>extras</strong><br>Es un apartado para la configuración específica, en este caso contiene la configuracion safe_label con valor true, indica que la etiqueta contiene HTML.</p>
</li>
</ul>
<p><strong>aria-expanded</strong> es un atributo de nodo contenedor ul, &lt;ul aria-expanded="true"&gt;, que indica si esta porción del menú aparecerá desplegada por defecto o no. Es interesante aprovechar para echar un ojo a la documentacion de sb-admin2 y así no sentirnos demasiado desorientados a la hora de trabajar con él.</p>
<p>A partir de aquí MetisMenu, implementado por sb-admin2, se encargará del resto. Incluso detectará si la url accedida es la definida en algún nodo para presentar esa porción del menú desplegado.</p>
<p>Ya solo nos falta acceder a la url del backend <a href="http://localhost:8000/backend/" target="_blank" rel="noopener">http://localhost:8000/backend/</a> para ver nuestro menú perfectamente representado. A partir de ahora solo será necesario refinarlo según nuestras necesidades, también creo, que si es necesario más de un menú complejo, será bueno crear clases para cada uno dentro de un subdirectorio de <strong>Menu</strong> e instanciarlos desde cada método del Builder, para evitar la excesiva complejidad de los métodos. Para probar que la sección se mantiene desplegada al acceder a la url contenida podemos probar con <a href="http://localhost:8000/backend/#test" target="_blank" rel="noopener">http://localhost:8000/backend/#test</a></p>
<h3 id="That’s-all-folks"><a href="#That’s-all-folks" class="headerlink" title="That’s all folks!!"></a>That’s all folks!!</h3><p>Otra vez cierro esperando poder continuar en breve, he visto un poco por encima la modularización del proyecto, y, la instalación de librerías de terceros bajo el concepto Symfony “Bundles”, en la próxima iteración intentaré empezar a poner pegamento sobre las piezas que hemos ido construyendo, tenemos bastantes partes del global, poco a poco intentaremos llegar a un backend flexible y escalable bajo el que desarrollar cualquier proyecto que deseemos.</p>
</div><div class="tags"><a href="/tags/PHP/">PHP</a><a href="/tags/Herramientas/">Herramientas</a><a href="/tags/Tutorial/">Tutorial</a><a href="/tags/Frameworks/">Frameworks</a></div><div class="post-nav"><a href="/retornando-objetos-valor/" class="pre"><i class="icon-previous">Retornando objetos de valor en lugar de arrays</i></a><a href="/descarga-ficheros-comprimidos-Archivestream-php/" class="next">Descarga de ficheros comprimidos con ArchiveStream-php<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'mercenariophp';
var disqus_identifier = 'tutorial-symfony-bundles-knpmenubundle/';
var disqus_title = 'Tutorial de Symfony 3: Bundles y KnpMenuBundle';
var disqus_url = 'https://www.mercenariophp.com/tutorial-symfony-bundles-knpmenubundle/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//mercenariophp.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"><input type="hidden" name="sitesearch" value="https://www.mercenariophp.com"></form></div><div class="widget lessMargin"><div style="text-align: left;"><div style="width: 84px; height: 40px;"><a href="https://twitter.com/mercenariophp" rel="nofollow" target="_blank" class="twitter_big"></a><a href="https://es.linkedin.com/in/moisés-barquín-salgado-b6148296" rel="nofollow" target="_blank" class="linkedin_big"></a></div></div></div><div class="widget"><div class="widget-title">Categorías</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Desarrollo/">Desarrollo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutoriales-Symfony/">Tutoriales Symfony</a></li></ul></div><div class="widget"><div class="widget-title">Etiquetas</div><div class="tagcloud"><a href="/tags/tests/" style="font-size: 15px;">tests</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/PagesGenerator/" style="font-size: 15px;">PagesGenerator</a> <a href="/tags/Herramientas/" style="font-size: 15px;">Herramientas</a> <a href="/tags/Tutorial/" style="font-size: 15px;">Tutorial</a> <a href="/tags/PHPUnit/" style="font-size: 15px;">PHPUnit</a> <a href="/tags/Composer/" style="font-size: 15px;">Composer</a> <a href="/tags/NetBeans/" style="font-size: 15px;">NetBeans</a> <a href="/tags/IDE/" style="font-size: 15px;">IDE</a> <a href="/tags/ReactPHP/" style="font-size: 15px;">ReactPHP</a> <a href="/tags/Slim/" style="font-size: 15px;">Slim</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/Pattern/" style="font-size: 15px;">Pattern</a> <a href="/tags/Repositorio/" style="font-size: 15px;">Repositorio</a> <a href="/tags/Frameworks/" style="font-size: 15px;">Frameworks</a></div></div><div class="widget"><div class="widget-title">Recientes</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/php-dotenv-variables-entorno/">PHP Dotenv, configuración en variables de entorno</a></li><li class="post-list-item"><a class="post-list-link" href="/vacaciones/">Vacaciones</a></li><li class="post-list-item"><a class="post-list-link" href="/retornando-objetos-valor/">Retornando objetos de valor en lugar de arrays</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-bundles-knpmenubundle/">Tutorial de Symfony 3: Bundles y KnpMenuBundle</a></li><li class="post-list-item"><a class="post-list-link" href="/descarga-ficheros-comprimidos-Archivestream-php/">Descarga de ficheros comprimidos con ArchiveStream-php</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-doctrine-orm/">Tutorial de Symfony 3: Doctrine ORM y Base de Datos</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony-twig/">Tutorial de Symfony 3: Twig, base layout con Bootstrap</a></li><li class="post-list-item"><a class="post-list-link" href="/tutorial-symfony/">Tutorial de Symfony 3: Instalación, routing y controllers</a></li><li class="post-list-item"><a class="post-list-link" href="/refactorizando-reactphp-slim/">Refactorizando reactphp-slim</a></li><li class="post-list-item"><a class="post-list-link" href="/editor-hackeable-atom/">Editor hackeable Atom, el editor para el siglo 21</a></li></ul></div><div class="widget"><div class="widget-title">Comentarios recientes</div><script type="text/javascript" src="//mercenariophp.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">Blogroll</div><ul></ul><a href="http://www.phptherightway.com/" title="PHP The Right Way" target="_blank">PHP The Right Way</a></div></div></div></div><div id="footer"><a href="https://twitter.com/mercenariophp" rel="nofollow" class="twitter"></a> <a href="https://es.linkedin.com/in/moisés-barquín-salgado-b6148296" rel="nofollow" class="linkedin"></a> © <a href="/." rel="nofollow">mercenariophp.</a> With<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-78289384-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>